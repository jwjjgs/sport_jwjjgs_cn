(this.webpackJsonpsport=this.webpackJsonpsport||[]).push([[0],{197:function(e,t,n){},277:function(e,t,n){"use strict";n.r(t);var a=n(284),r=n(32),c=n.n(r),i=n(0),o=n(26),s=n.n(o),u=(n(197),n(57)),l=n(25),d=n(131),j=n.n(d),b=n(154),h=n(60),p=n(155),f=n(48),m=n(170),O=n(279),g=n(81),v=n(286),x=n(280),y=n(283),k=n(281),I=n(285),w=n(282),T=n(287),S=n(288),A=n(174),C=n(65),R=n.n(C),P=n(156),B=n.n(P),F=n(99),L=n(7),q="V 2.5.6",E=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return parseFloat(e)+E(-1*t,t)/t/1e7},M=function(){return new Promise((function(e,t){c.a.get("/health/api/v1/homePage/user").then((function(t){var n=t.runningRule,a=n.rule,r=n.userCampus,c=t.semesterRunningRecord.validRunningNum,i=t.runningRule.goal.semesterGoal;e({rule:a,userCampus:r,valid:c,total:i})})).catch((function(){t(!1)}))}))},N=function(e,t){return new Promise((function(n,a){var r={};switch(t){case 368:r.latitude="30.786842".concat(E(1e4,99999)),r.longitude="103.886128".concat(E(1e4,99999));break;case 53:r.latitude="30.826795".concat(E(1e4,99999)),r.longitude="104.18535".concat(E(1e4,99999));break;case 444:r.latitude="30.82454".concat(E(1e4,99999)),r.longitude="106.118579".concat(E(1e4,99999));break;case 386:r.latitude="30.728711".concat(E(1e4,99999)),r.longitude="103.965401".concat(E(1e4,99999));break;case 418:r.latitude="30.764069".concat(E(1e4,99999)),r.longitude="103.985006".concat(E(1e4,99999));break;default:return a(!1)}var i=Object.assign({},{campusId:e,type:1},Object(f.a)({},r));c.a.post("/running/api/v1/running/start",Object(f.a)({},i)).then((function(e){var t=e.randomCircuit;n(Object(f.a)({},t))})).catch((function(){a(!1)}))}))},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;return new Promise((function(r,i){var o=Object(f.a)(Object(f.a)({},e),{},{time:R()().format("YYYY-MM-DD HH:mm:ss")}),s={circuitInfo:{circuitString:JSON.stringify(o)},version:q,valid:1,id:1,type:1,platform:1,stepRate:E(40,80),invalidReason:"",distance:t,validDistance:t,phone:"",startTime:R()().valueOf(),endTime:R()().add(n,"seconds").valueOf(),calories:parseInt(t/20),totalTime:n},u=[],l=[],d=[],j=[],b=o.randomCircuit,h=b.requireLatitude,m=b.requireLongitude;if(a){var O=JSON.parse(F.a.decode(a));u=O.latitude.map((function(e){return Array.isArray(e)?e.map((function(e){return J(e)})):J(e)})),l=O.longitude.map((function(e){return Array.isArray(e)?e.map((function(e){return J(e)})):J(e)})),d=O.speed.map((function(e){return Array.isArray(e)?e.map((function(){return E(2,20)})):e}));var g,v={avg:s.totalTime/d.length,start:0},x=Object(p.a)(u);try{for(x.s();!(g=x.n()).done;){var y=g.value,k=[];if(Array.isArray(y)){for(var I=0;I<y.length-1;I++)v.start+=v.avg+E(-10,10),k.push(R()().add(v.start,"seconds").valueOf());j.push(k)}}}catch(S){x.e(S)}finally{x.f()}}else{for(var w=0;w<3;w++)u.push(h[w]),l.push(m[w]),d.push(E(2,20));u=[u],l=[l],j=[[s.startTime+E(10,100),s.endTime-E(1500,2500)]]}s.circuitInfo=Object(f.a)(Object(f.a)({},s.circuitInfo),{},{latitude:u,longitude:l,segment:j,speed:d,calories:parseInt(t/20)}),s.md5=B()("EndRunningInfo{a='".concat(s.invalidReason,"', b=").concat(s.totalTime,", c=").concat(s.distance,", d=").concat(s.type,", e=").concat(s.startTime,", f=").concat(s.endTime,", g='").concat(s.phone,"'}"));var T={};Object.keys(s).sort().map((function(e){return T[e]=s[e]})),c.a.post("/running/api/v1/running/end3",T).then((function(e){r(e)})).catch((function(){i(!1)}))}))};var D=function(){var e=Object(i.useState)([]),t=Object(h.a)(e,2),n=t[0],r=t[1],o=Object(i.useState)({valid:0,total:0}),s=Object(h.a)(o,2),l=s[0],d=s[1],p=Object(a.b)((function(e){return new Promise(function(){var t=Object(b.a)(j.a.mark((function t(n,a){var r,c,i,o,s,u,l;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.distance,c=e.time,i=e.path,t.next=3,M().catch((function(){return a("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25")}));case 3:return o=t.sent,t.next=6,N(o.rule.campusId,o.rule.orgId).catch((function(){return a("\u83b7\u53d6\u8dd1\u6b65\u4fe1\u606f\u5931\u8d25")}));case 6:return s=t.sent,t.next=9,z({runningRule:o,randomCircuit:s},r,c,i).catch((function(e){a("\u7ed3\u675f\u8dd1\u6b65\u5931\u8d25".concat(e.message))}));case 9:u=t.sent,l=u.invalidReason,1===u.valid?n(!0):a(l);case 12:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}),{manual:!0,onSuccess:function(){m.b.success("\u8dd1\u6b65\u5b8c\u6210"),F()},onError:function(e){m.b.error(e),F()}}),f=p.loading,C=p.run,P=Object(a.b)((function(){return e=1,new Promise((function(t,n){var a=R()().subtract(720,"days").valueOf(),r=R()().valueOf();c.a.post("running/api/v1/running/recordList",{pageNum:e,pageSize:100,startTime:a,endTime:r}).then((function(e){t(e.items)})).catch((function(){n("\u83b7\u53d6\u5217\u8868\u5931\u8d25")}))}));var e}),{manual:!0,onSuccess:function(e){r(e)},onError:function(e){m.b.error(e)}}),B=P.loading,F=P.run;return Object(i.useEffect)((function(){F(),M().then((function(e){d({valid:e.valid,total:e.total})}))}),[]),Object(L.jsx)(L.Fragment,{children:Object(L.jsx)(O.a,{title:"\u4e50\u5065",subTitle:"\u5b8c\u5168\u514d\u8d39",extra:Object(L.jsx)(u.b,{to:"/login",children:Object(L.jsx)(g.a,{type:"link",children:"\u5207\u6362\u8d26\u53f7"})}),children:Object(L.jsxs)(v.b,{direction:"vertical",style:{width:"100%"},size:"large",children:[Object(L.jsxs)(x.a,{title:"\u544a\u77e5",extra:Object(L.jsx)("b",{children:"\u6700\u540e\u66f4\u65b0 2021/03/24"}),children:[Object(L.jsxs)(y.a.Text,{children:["1.\u672c\u529f\u80fd\u5c5e\u4e8e\u7eaf\u524d\u7aef\u5b9e\u73b0\uff0c\u4e0d\u5b58\u5728\u6536\u96c6\uff0c\u4fdd\u7559\u7528\u6237\u4fe1\u606f\u7b49",Object(L.jsx)("br",{})]}),Object(L.jsxs)(y.a.Text,{children:["2.\u4ec5\u4f9b\u5b66\u4e60\u7814\u7a76\u4f7f\u7528\uff0c\u5207\u52ff\u7528\u4e8e\u975e\u6cd5\u6216\u5546\u4e1a\u7b49\u7528\u9014",Object(L.jsx)("br",{})]}),Object(L.jsxs)(y.a.Text,{children:["3.\u5b8c\u5168\u514d\u8d39\u5f00\u6e90\uff0c\u8bf7\u52ff\u4e0a\u5f53\u53d7\u9a97\uff0c\u5982\u679c\u4f60\u662f\u6536\u8d39\u770b\u5230\u9875\u9762\uff0c\u8bf7\u53ca\u65f6\u4e3e\u62a5\u8bc8\u9a97\u8005",Object(L.jsx)("br",{})]}),Object(L.jsxs)(y.a.Text,{children:["4.github:",Object(L.jsx)("a",{href:"https://github.com/jwjjgs/sport_jwjjgs_cn",children:"\u70b9\u6211\u67e5\u770b\u5f00\u6e90\u4ee3\u7801/\u66f4\u65b0\u65e5\u5fd7"}),Object(L.jsx)("br",{})]})]}),Object(L.jsx)(x.a,{title:"\u529f\u80fd",children:Object(L.jsxs)(k.a,{onFinish:function(e){C(e)},children:[Object(L.jsx)(k.a.Item,{name:"path",children:Object(L.jsx)(I.a,{addonBefore:"\u8f68\u8ff9",placeholder:"\u8bf7\u7c98\u8d34\u5bfc\u51fa\u8f68\u8ff9(\u9009\u586b)"})}),Object(L.jsx)(k.a.Item,{name:"distance",children:Object(L.jsx)(I.a,{addonBefore:"\u8ddd\u79bb",addonAfter:"\u7c73"})}),Object(L.jsx)(k.a.Item,{name:"time",children:Object(L.jsx)(I.a,{addonBefore:"\u65f6\u95f4",addonAfter:"\u79d2"})}),Object(L.jsx)(k.a.Item,{children:Object(L.jsxs)(g.a,{htmlType:"submit",type:"primary",block:!0,loading:f,children:["\u5954\u8dd1(","".concat(l.valid,"/").concat(l.total),")"]})})]})}),Object(L.jsx)(w.b,{loading:B,itemLayout:"horizontal",dataSource:n,renderItem:function(e){return Object(L.jsxs)(w.b.Item,{children:[Object(L.jsx)(w.b.Item.Meta,{avatar:1===e.valid?Object(L.jsx)(T.a,{twoToneColor:"#52c41a"}):Object(L.jsx)(S.a,{twoToneColor:"#eb2f96"}),title:"\u8ddd\u79bb:".concat(e.validDistance,"\u7c73 \u65f6\u95f4:").concat(e.totalTime>=60&&parseInt(e.totalTime/60)+"\u5206").concat(e.totalTime%60+"\u79d2"),description:e.startTime}),Object(L.jsx)(u.b,{to:{pathname:"/map",state:{circuitInfo:JSON.parse(e.circuitInfo)}},children:Object(L.jsx)(g.a,{icon:Object(L.jsx)(A.a,{}),type:"link"})})]})}})]})})})},Y=n(92);var _=function(){var e=Object(l.g)(),t=Object(i.useState)([]),n=Object(h.a)(t,2),r=n[0],o=n[1];Object(i.useEffect)((function(){c.a.get("/health/api/v2/organization/list",{params:{orgType:1}}).then((function(e){o(e.map((function(e){return{label:e.name,value:e.id}})))}))}),[]);var s=Object(a.b)((function(e){return{url:"/health/api/v1/login",method:"post",data:Object(f.a)({},e)}}),{manual:!0,onSuccess:function(t){var n=t.token;localStorage.setItem("token","Bearer ".concat(n)),m.b.success("\u767b\u9646\u6210\u529f"),e.push("/")}}),u=s.loading,d=s.run;return Object(L.jsx)(L.Fragment,{children:Object(L.jsx)(O.a,{title:"\u767b\u5f55",children:Object(L.jsxs)(k.a,{onFinish:function(e){return d(e)},initialValues:{username:"",password:""},children:[Object(L.jsx)(k.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8d26\u53f7"}],children:Object(L.jsx)(I.a,{addonBefore:"\u8d26\u53f7",type:"tel",maxLength:11})}),Object(L.jsx)(k.a.Item,{name:"password",maxLength:16,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}],children:Object(L.jsx)(I.a.Password,{addonBefore:"\u5bc6\u7801"})}),Object(L.jsx)(k.a.Item,{name:"orgId",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5730\u533a"}],children:Object(L.jsx)(Y.a,{options:r})}),Object(L.jsx)(k.a.Item,{children:Object(L.jsx)(g.a,{htmlType:"submit",type:"primary",block:!0,loading:u,children:"\u767b\u5f55"})})]})})})},H=n(113),V=n(167),G=n.n(V),U=n(289),W=n(111),K=n.n(W);var Q=function(e){var t=Object(i.useState)(null),n=Object(h.a)(t,2),a=n[0],r=n[1];return Object(i.useEffect)((function(){try{var t=e.location.state.circuitInfo,n=t.longitude,a=t.latitude,c=t.speed;r({longitude:n,latitude:a,speed:c});for(var i=function(e,t){return Array.isArray(t)?e.push.apply(e,Object(H.a)(t)):e.push(t),e},o=n.reduce(i,[]),s=a.reduce(i,[]),u=[],l=0;l<o.length;l++)u.push([o[l],s[l]]);u.length>0&&G.a.load({key:"3f3868abdb36336114bde5ab6eecdb68",plugins:[]}).then((function(e){var t=new e.Map("map",{center:u[0],zoom:17}),n=new e.Polyline({path:u,strokeColor:"#3366FF",strokeWeight:3,strokeStyle:"solid"});t.add(n)})).catch((function(e){console.log(e)}))}catch(d){}}),[e]),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(O.a,{title:"\u8f68\u8ff9\u663e\u793a",onBack:function(){e.history.push("/")},extra:[Object(L.jsx)(g.a,{type:"link",icon:Object(L.jsx)(U.a,{}),onClick:function(){try{if(!a)return void m.b.warning("\u5bfc\u51fa\u5931\u8d25");var e=JSON.stringify(a);K()(F.a.encode(e)),m.b.success("\u5bfc\u51fa\u6210\u529f")}catch(t){m.b.warning("\u5bfc\u51fa\u5931\u8d25")}}},"export")]}),Object(L.jsx)("div",{style:{height:"100vh",paddingTop:"72px",marginTop:"-72px"},children:Object(L.jsx)("div",{id:"map",style:{height:"100%"}})})]})};var X=function(){return Object(L.jsx)(u.a,{children:Object(L.jsxs)(l.d,{children:[Object(L.jsx)(l.b,{path:"/login",component:_}),Object(L.jsx)(l.b,{path:"/",render:function(){return localStorage.getItem("token")?Object(L.jsxs)(l.d,{children:[Object(L.jsx)(l.b,{path:"/map",component:Q}),Object(L.jsx)(l.b,{path:"/",component:D})]}):Object(L.jsx)(l.a,{to:"/login"})}})]})})},Z=new u.a;c.a.defaults.withCredentials=!1,c.a.defaults.baseURL="https://upes.legym.cn/",c.a.defaults.headers.post["Content-Type"]="application/json;; charset=utf-8",c.a.interceptors.request.use((function(e){"post"===e.method.toLowerCase()&&"object"===typeof e.data&&(e.data=JSON.stringify(e.data));var t=localStorage.getItem("token");return t&&(e.headers.authorization=t),e})),c.a.interceptors.response.use((function(e){var t=e.data,n=t.code,a=t.message,r=t.data;if(0!==n){var c=a||"\u672a\u77e5\u539f\u56e0";return m.b.warning({content:c,key:c}),Promise.reject()}return a&&m.b.success({content:a,key:a}),r}),(function(e){var t=e.response,n=t.status,a=t.data.error_description;if(401===n){var r="\u767b\u5f55\u5931\u6548";m.b.warning({content:r,key:r}),localStorage.clear("token"),Z.history.push("/login")}else{var c=a;m.b.warning({content:c,key:c})}})),s.a.render(Object(L.jsx)(a.a,{value:{requestMethod:function(e){return c()(e)}},children:Object(L.jsx)(X,{})}),document.getElementById("root"))}},[[277,1,2]]]);
//# sourceMappingURL=main.727b8932.chunk.js.map